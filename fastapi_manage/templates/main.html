<html>
    <head>
        <title>CODE APP</title>
        
        <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css"
        />
        
        <script
          src="https://code.jquery.com/jquery-3.1.1.min.js"
          integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
          crossorigin="anonymous"
        ></script>
        
        <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css">
<script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.js"></script>
    </head>
<body>
    <script>
    $(document).ready(function () {
      var num;
      var input;
      $("#add_button").click(function () {
        $("#add").modal("show");
      });
      $("#save_button").click(function () {
        client = $("#input_client").val();
        expired = $("#input_expired").val();
        mac_address=$("#input_mac_address").val();
        console.log(client);
        $.ajax({
          url: "/register",
          type: "POST",
          //data: { "user": user, "code":,"expired":expired, "mac_address":mac_address },
          data: JSON.stringify({ "user": client,"expired":expired, "mac_address":mac_address }),
          success: function () { 
          alert("Success ADD!")  //請求成功後執行的操作
           window.location.reload()  //重新整理頁面
        }  
    }).then(setTimeout(location.reload.bind(location), 200));
      }
      );
      $(".mini.ui.primary.button").click(function () {
        num = this.id;
        console.log(num);
        $.ajax({
          url: "/register/" + num,
          type: "GET",
        }).then(function (c) {
          $("#edit_client").val(c.user);
          $("#edit_expired").val(c.expired);
          $("#edit_mac_address").val(c.mac_address);
          $("#update").modal("show");
        });
      });
      $("#edit_save_button").click(function () {
        
        client = $("#edit_client").val();
        expired = $("#edit_expired").val();
        mac_address=$("#edit_mac_address").val();
        console.log(client);
        
        $.ajax({
          url: "/register/" + num,
          type: "PUT",
          data: JSON.stringify({ "user": client,"expired":expired, "mac_address":mac_address }),
          success: function () { 
          alert("Success Edit!")  //請求成功後執行的操作
           window.location.reload()  //重新整理頁面
        }
        }).then(setTimeout(location.reload.bind(location), 200));
      });
      
      $(".mini.ui.green.button").click(function () {
        num=this.id;
        alert("Start to Download !")
        $.ajax({
          url: "/downloadfile/" + num,
          type: "get",
          data: JSON.stringify({ "code_id": num}),
          
        }).then(setTimeout(location.reload.bind(location), 200));
      });
      $(".mini.ui.red.button").click(function () {
        num = this.id;
        input = document.getElementById("saved_text_" + num).innerHTML;
        console.log(input);
        $.ajax({
          url: "/register/" + num,
          type: "DELETE",
        }).then(setTimeout(location.reload.bind(location), 200));
      });
      $("#submit_search").click(function () {
        
        q=$("#search_bar").val();
        //q = document.getElementById("search_bar").innerHTML;
        
        alert(q);
        $.ajax({
          url: "/filter/" + q,
          type: "GET",
        }).then(setTimeout(location.reload.bind(location), 200));
      });
    });
  </script>
    
<div class="ui raised very padded text container segment">
    <h1 style="text-align: center;">Code LIST</h1>
    <button class="ui primary button" id="add_button">
      <i class="plus icon"></i>
      Add
    </button>
    
    
    <h2 class="ui header">Code Management</h2>

    <div class="container">
      <div class="col-xs-6 col-xs-offset-3">
        
           
           <div class="input-group">	
              <input type="text" class="form-control input-lg " id="search_bar" name="q" placeholder= "Search Code "/>
              <span class='input-group-btn'>
  
               <button id="submit_search" class='btn btn-info btn-lg'>Search
               </button>
           </span>
          </div>
    
     
  
   </div>
  </div>
    <hr />
    <div class="ui middle aligned divided list">
      {% for item in all_item%}
      <div class="item">
        <div class="right floated content">
          <button class="mini ui primary button" id="{{item['id']}}">
            <i class="pencil alternate icon"></i>
            Edit
          </button>
          
          <button class="mini ui red button" id="{{item['id']}}">
            <i class="trash icon"></i>
            Delete
          </button>
          
          <a href="/download/{{item['id']}}" class="mini ui green button" id="{{item['id']}}" download="licensefile.skm">
            <i class="bi bi-cloud-arrow-down"></i>
            Download
          </a>
        </div>
        
        <div class="content">
          <p id="saved_text_{{item['id']}}">Client:{{item['user']}}</p>
          <p>Expired:{{item['expired']}}</p>
          <p>MAC_ADDRESS:{{item['mac_address']}}</p>
        </div>
        
      </div>
      {% endfor %}
      <div aria-label="Pagination Navigation" role="navigation" class="ui pagination menu">
          <a aria-current="false" aria-disabled="false" tabindex="0" value="1" aria-label="Previous item" type="prevItem" class="item">⟨</a>
          <a aria-current="true" aria-disabled="false" tabindex="0" value="1" type="pageItem" class="active item">1</a>
          <a aria-current="false" aria-disabled="false" tabindex="0" value="2" type="pageItem" class="item">2</a>
          <a aria-current="false" aria-disabled="false" tabindex="0" value="3" type="pageItem" class="item">3</a>
          <a aria-current="false" aria-disabled="false" tabindex="0" value="2" aria-label="Next item" type="nextItem" class="item">⟩</a>
        </div>
    </div>
   
   
    <div class="ui tiny modal" id="add">
      <div class="header">New Code</div>
      <div class="content">
        <div class="ui fluid icon input">
          <input type="text" placeholder="New Client....." id="input_client" />
          <input type="text" placeholder="Expired....." id="input_expired" />
          
          <input type="text" placeholder="MAC Address....." id="input_mac_address" />
        </div>
      </div>
      <div class="actions">
        <div class="ui approve button" id="save_button">Save</div>
      </div>
    </div>
    <div class="ui tiny modal" id="update">
      <div class="header">Update Code</div>
      <div class="content">
        <div class="ui fluid icon input">
           <p>Client </p> 
          <input type="text" id="edit_client" />
          <p>Expired </p>
          <input type="text" id="edit_expired" />
          <p>MAC Address </p>
          <input type="text" id="edit_mac_address" />
        </div>
      </div>
      <div class="actions">
        <div class="ui approve button" id="edit_save_button">Save</div>
      </div>
    </div>
  </div>
  </body>

</html>